AWSTemplateFormatVersion: "2010-09-09"

Parameters:
  S3BucketName:
    Type: String
    Default: regulated-bucket1
  Username:
    Type: String
    Default: test1
  Internet:
    Type: String
    Default: Disabled
    AllowedValues:
      - Enabled
      - Disabled
  KeyAlias:
    Type: String
    Default: alias/regulated-key1

Resources:
  Keys:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: ./keys.yaml
      Parameters:
        KeyAlias: !Ref KeyAlias

  Vpc:
    Type: AWS::CloudFormation::Stack
    DependsOn:
      - Keys
    Properties:
      TemplateURL: ./vpc.yaml

  Storage:
    Type: AWS::CloudFormation::Stack
    DependsOn:
      - Keys
    Properties:
      TemplateURL: ./s3.yaml
      Parameters:
        S3BucketName: !Ref S3BucketName

  Sagemaker:
    Type: AWS::CloudFormation::Stack
    DependsOn:
      - Storage
      - Vpc
    Properties:
      TemplateURL: ./sagemaker_nb.yaml
      Parameters:
        S3BucketName: !Ref S3BucketName
        Username: !Ref Username
        Internet: !Ref Internet
